version: "3.8"

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: 4biz-notfy-app
    restart: unless-stopped
    ports:
      - "1177:3000"

    # Limites de recursos para otimizar uso de máquina
    deploy:
      resources:
        limits:
          cpus: "1.0" # Máximo 1 CPU
          memory: 1G # Máximo 1GB RAM
        reservations:
          cpus: "0.25" # Mínimo 0.25 CPU
          memory: 256M # Mínimo 256MB RAM

    # Shared memory otimizado para Chromium
    shm_size: 256mb

    environment:
      # Database
      - MONGODB_URI=mongodb+srv://example_user:example_password@cluster0.example.mongodb.net/4biz-notify

      # NextAuth
      - NEXTAUTH_SECRET=example_nextauth_secret_123456789
      - NEXTAUTH_URL=http://localhost:1177

      # Web Push VAPID
      - VAPID_PUBLIC_KEY=BEXAMPLE_VAPID_PUBLIC_KEY_123456
      - VAPID_PRIVATE_KEY=BEXAMPLE_VAPID_PRIVATE_KEY_654321
      - VAPID_SUBJECT=mailto:example@email.com

      # Application
      - NODE_ENV=production
      - PUPPETEER_HEADLESS=true

      # Otimizações de recursos
      - NODE_OPTIONS=--max-old-space-size=768
      - CRON_INTERVAL_MINUTES=5
      - ENCRYPTION_KEY=your-encryption-key-here-minimum-32-characters
